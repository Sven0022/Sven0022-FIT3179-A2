{
    "$schema": "https://vega.github.io/schema/vega/v5.json",
    "description": "Treemap of Emissions Data",
    "width": 960,
    "height": 500,
    "padding": 2.5,
    "autosize": "none",
    "signals": [
        {
            "name": "layout",
            "value": "squarify",
            "bind": {
                "input": "select",
                "options": ["squarify", "binary", "slicedice"]
            }
        },
        {
            "name": "aspectRatio",
            "value": 1.6,
            "bind": { "input": "range", "min": 1, "max": 5, "step": 0.1 }
        }
    ],
    "data": [
        {
            "name": "tree",
            "url": "emissions_hierarchy.json",
            "format": {
                "type": "json"
            },
            "transform": [
                {
                    "type": "stratify",
                    "key": "id",
                    "parentKey": "parent"
                },
                {
                    "type": "treemap",
                    "field": "emissions",
                    "sort": { "field": "emissions", "order": "descending" },
                    "round": true,
                    "method": { "signal": "layout" },
                    "ratio": { "signal": "aspectRatio" },
                    "size": [{ "signal": "width" }, { "signal": "height" }]
                }
            ]
        }
    ],
    "scales": [
        {
            "name": "color",
            "type": "ordinal",
            "domain": { "data": "tree", "field": "name" },
            "range": [
                "#3182bd", "#6baed6", "#9ecae1", "#c6dbef", "#e6550d",
                "#fd8d3c", "#fdae6b", "#fdd0a2", "#31a354", "#74c476",
                "#a1d99b", "#c7e9c0", "#756bb1", "#9e9ac8", "#bcbddc",
                "#dadaeb", "#636363", "#969696", "#bdbdbd", "#d9d9d9"
            ]
        }
    ],
    "marks": [
        {
            "type": "rect",
            "from": { "data": "tree" },
            "interactive": true,
            "encode": {
                "enter": {
                    "fill": { "scale": "color", "field": "name" },
                    "stroke": {
                        "condition": {
                            "test": "datum.depth == 1",  
                            "value": "black"
                        },
                        "value": null 
                    },
                    "strokeWidth": {
                        "condition": {
                            "test": "datum.depth == 1",  
                            "value": 2
                        },
                        "value": 0
                    }
                },
                "update": {
                    "x": { "field": "x0" },
                    "y": { "field": "y0" },
                    "x2": { "field": "x1" },
                    "y2": { "field": "y1" }
                }
            }
        },
        {
            "type": "text",
            "from": { "data": "tree" },
            "encode": {
                "enter": {
                    "text": { "field": "name" },
                    "fontSize": { "value": 12 },
                    "fill": { "value": "#000" }
                },
                "update": {
                    "x": { "signal": "0.5 * (datum.x0 + datum.x1)" },
                    "y": { "signal": "0.5 * (datum.y0 + datum.y1)" },
                    "align": { "value": "center" },
                    "baseline": { "value": "middle" }
                }
            }
        }
    ]
}
